{"type":"operationStart","subtype":"profile","data":{"_id":"5VLwewCSSSyCk3Zu","timestamp":"2023-01-27T13:59:45.549Z","state":"queued","mode":"standard","creationDate":"2023-01-27T13:59:45.550Z","modificationDate":"2023-01-27T13:59:45.550Z","shortid":"-Hk8Wi2","$entitySet":"profiles"},"doDiffs":false,"timestamp":1674827985549,"id":"1z3wszggup74gqf","previousOperationId":null,"operationId":"hmb7bybm5pk8sni"}
{"type":"log","level":"info","message":"Render request 3 queued for execution and waiting for available worker","previousOperationId":"hmb7bybm5pk8sni","timestamp":1674827985550,"id":"x67by9b29gaum6e"}
{"type":"operationStart","subtype":"render","name":"SpaceInVRs-main","previousOperationId":"hmb7bybm5pk8sni","timestamp":1674827985560,"id":"lp44blbw3nz6jxc","previousEventId":"1z3wszggup74gqf","operationId":"a7v72i7k7kh864y"}
{"type":"log","timestamp":1674827985561,"level":"info","message":"Starting rendering request 3","meta":{"rootId":"3nff1usr7m4rhq9","id":"3nff1usr7m4rhq9"},"id":"9hh9yu2fdrs1yha","previousOperationId":"a7v72i7k7kh864y"}
{"type":"log","timestamp":1674827985561,"level":"info","message":"Rendering template { name: SpaceInVRs-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"3nff1usr7m4rhq9","id":"3nff1usr7m4rhq9"},"id":"g385i6swmzwmoqz","previousOperationId":"a7v72i7k7kh864y"}
{"type":"log","timestamp":1674827985563,"level":"debug","message":"Inline data specified.","meta":{"rootId":"3nff1usr7m4rhq9","id":"3nff1usr7m4rhq9"},"id":"tzphuqxdsimec0k","previousOperationId":"a7v72i7k7kh864y"}
{"type":"log","timestamp":1674827985565,"level":"debug","message":"Executing script SpaceInVRs-mainscript (beforeRender)","meta":{"rootId":"3nff1usr7m4rhq9","id":"3nff1usr7m4rhq9"},"id":"ohk3wj8grx6410t","previousOperationId":"a7v72i7k7kh864y"}
{"type":"log","timestamp":1674827985600,"level":"warn","message":"Error when processing render request 3\n(because) error when evaluating custom script /SpaceInVRs/SpaceInVRs-mainscript\nrequire of \"axios\" module has been blocked. To be able to require custom modules you need to add to configuration { \"trustUserCode\": true } or enable just specific module using { sandbox: { allowedModules\": [\"axios\"] }\n\n(sandbox.js line 3:15)\n\n  1 | // Use the \"beforeRender\" or \"afterRender\" hook\n  2 | // to manipulate and control the report generation\n> 3 | const axios = require('axios');\n    |               ^\n  4 | const nodemailer = require('nodemailer')\n  5 |\n  6 | async function beforeRender(req, res) {\n\n(sandbox.js line 60:42)\n\n  58 | // }\n\n\nError: require of \"axios\" module has been blocked. To be able to require custom modules you need to add to configuration { \"trustUserCode\": true } or enable just specific module using { sandbox: { allowedModules\": [\"axios\"] }\n    at _require (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:79:19)\n    at require (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:112:21)\n    at VM2 Wrapper.apply (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\vm2\\lib/bridge.js:485:11)\n    at sandbox.js:3:15\n    at sandbox.js:60:42\n    at Script.runInContext (node:vm:141:12)\n    at VM.runScript (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\vm2\\lib\\vm.js:285:18)\n    at VM.run (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\vm2\\lib\\vm.js:503:16)\n    at run (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:173:25)\n    at run (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:184:30)","meta":{"rootId":"3nff1usr7m4rhq9","id":"3nff1usr7m4rhq9"},"id":"a7et3l5wp8qwyv8","previousOperationId":"a7v72i7k7kh864y"}
{"type":"log","timestamp":1674827985600,"level":"warn","message":"Rendering request 3 finished with error in 52 ms","meta":{"rootId":"3nff1usr7m4rhq9","id":"3nff1usr7m4rhq9"},"id":"yyvkfoka02i3l82","previousOperationId":"a7v72i7k7kh864y"}
{"type":"error","timestamp":1674827985605,"statusCode":400,"weak":true,"decoratedSuffix":"\n\n(sandbox.js line 3:15)\n\n  1 | // Use the \"beforeRender\" or \"afterRender\" hook\n  2 | // to manipulate and control the report generation\n> 3 | const axios = require('axios');\n    |               ^\n  4 | const nodemailer = require('nodemailer')\n  5 |\n  6 | async function beforeRender(req, res) {\n\n(sandbox.js line 60:42)\n\n  58 | // }\n\n","entity":{"shortid":"9YPNq7VwU2","name":"SpaceInVRs-mainscript","content":"// Use the \"beforeRender\" or \"afterRender\" hook\n// to manipulate and control the report generation\nconst axios = require('axios');\nconst nodemailer = require('nodemailer')\n\nasync function beforeRender(req, res) {\n\n\n    const resSessions = await axios.get('http://localhost:4000/api/sessions')\n    console.log(resSessions)\n    req.data.sessions = { ...req.data,\n        ...resSessions.data\n    }\n\n    req.data.score = req.data.sessions.score;\n    req.data.ships_destroyed = req.data.sessions.ships_destroyed;\n    req.data.bullets_fired = req.data.sessions.bullets_fired;\n    req.data.powerups = req.data.sessions.powerups;\n\n    console.log(\"Aquí el score: \" + req.data.score);\n    console.log(\"Aquí las naves destruidas: \" + req.data.ships_destroyed);\n\n    const resUsers = await axios.get('http://localhost:4000/api/users')\n    console.log(resUsers)\n    req.data.users = { ...req.data,\n        ...resUsers.data\n    }\n\n    req.data.user = req.data.users;\n\n}\n\n// async function afterRender(req, res) {\n\n//     const transporter = nodemailer.createTransport({\n//         host: 'smtp.ethereal.email',\n//         port: 587,\n//         auth: {\n//             user: 'isom26@ethereal.email',\n//             pass: 'sQEWpaYJug5tattpkZ'\n//         }\n//     });\n\n\n\n\n//     await transporter.sendMail({\n//         from: 'kvalls.contact@gmail.com',\n//         to: \"isom26@ethereal.email\",\n//         subject: 'CRUD report',\n//         text: '...',\n//         attachments: [{\n//             filename: 'Data.pdf',\n//             content: Buffer.from(res.content)\n//         }],\n//     })\n\n// }"},"property":"content","logged":true,"previousOperationId":"a7v72i7k7kh864y","id":"vwdfd0cbryfclua","stack":"Error: require of \"axios\" module has been blocked. To be able to require custom modules you need to add to configuration { \"trustUserCode\": true } or enable just specific module using { sandbox: { allowedModules\": [\"axios\"] }\n    at _require (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:79:19)\n    at require (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:112:21)\n    at VM2 Wrapper.apply (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\vm2\\lib/bridge.js:485:11)\n    at sandbox.js:3:15\n    at sandbox.js:60:42\n    at Script.runInContext (node:vm:141:12)\n    at VM.runScript (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\vm2\\lib\\vm.js:285:18)\n    at VM.run (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\vm2\\lib\\vm.js:503:16)\n    at run (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:173:25)\n    at run (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:184:30)","message":"Error when evaluating custom script /SpaceInVRs/SpaceInVRs-mainscript\nrequire of \"axios\" module has been blocked. To be able to require custom modules you need to add to configuration { \"trustUserCode\": true } or enable just specific module using { sandbox: { allowedModules\": [\"axios\"] }\n\n(sandbox.js line 3:15)\n\n  1 | // Use the \"beforeRender\" or \"afterRender\" hook\n  2 | // to manipulate and control the report generation\n> 3 | const axios = require('axios');\n    |               ^\n  4 | const nodemailer = require('nodemailer')\n  5 |\n  6 | async function beforeRender(req, res) {\n\n(sandbox.js line 60:42)\n\n  58 | // }\n\n"}
