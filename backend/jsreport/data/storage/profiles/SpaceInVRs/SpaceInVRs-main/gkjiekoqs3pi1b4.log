{"type":"operationStart","subtype":"profile","data":{"_id":"oSfQKUqtngO8I2JH","timestamp":"2023-01-27T15:33:31.173Z","state":"queued","mode":"standard","creationDate":"2023-01-27T15:33:31.175Z","modificationDate":"2023-01-27T15:33:31.175Z","shortid":"YJtbHkN","$entitySet":"profiles"},"doDiffs":false,"timestamp":1674833611174,"id":"ofd3mo2tdzozkjq","previousOperationId":null,"operationId":"lor80tibsggnol8"}
{"type":"log","level":"info","message":"Render request 20 queued for execution and waiting for available worker","previousOperationId":"lor80tibsggnol8","timestamp":1674833611174,"id":"wdcngozxqum1fdr"}
{"type":"operationStart","subtype":"render","name":"SpaceInVRs-main","previousOperationId":"lor80tibsggnol8","timestamp":1674833611182,"id":"l97gha48f22e4v5","previousEventId":"ofd3mo2tdzozkjq","operationId":"tqq8rusyh84l1im"}
{"type":"log","timestamp":1674833611182,"level":"info","message":"Starting rendering request 20","meta":{"rootId":"gkjiekoqs3pi1b4","id":"gkjiekoqs3pi1b4"},"id":"pfyzwu5biwbi6k1","previousOperationId":"tqq8rusyh84l1im"}
{"type":"log","timestamp":1674833611182,"level":"info","message":"Rendering template { name: SpaceInVRs-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"gkjiekoqs3pi1b4","id":"gkjiekoqs3pi1b4"},"id":"62y8lu1xh9z9uu7","previousOperationId":"tqq8rusyh84l1im"}
{"type":"log","timestamp":1674833611184,"level":"debug","message":"Adding sample data 44EIOSaAC","meta":{"rootId":"gkjiekoqs3pi1b4","id":"gkjiekoqs3pi1b4"},"id":"0zulm1l2ho72wt0","previousOperationId":"tqq8rusyh84l1im"}
{"type":"log","timestamp":1674833611186,"level":"debug","message":"Executing script SpaceInVRs-mainscript (beforeRender)","meta":{"rootId":"gkjiekoqs3pi1b4","id":"gkjiekoqs3pi1b4"},"id":"0ez3wlv0txrz4mp","previousOperationId":"tqq8rusyh84l1im"}
{"type":"log","timestamp":1674833611252,"level":"warn","message":"Error when processing render request 20\n(because) error when evaluating custom script /SpaceInVRs/SpaceInVRs-mainscript\nbtoa is not defined\n\n(sandbox.js line 8:31)\n\n   6 | const options = {\n   7 |   headers: {\n>  8 |     'Authorization': 'Basic ' + btoa(username + ':' + password)\n     |                               ^\n   9 |   }\n  10 | };\n  11 |\n\n(sandbox.js line 66:42)\n\n  64 | // }\n\n\nReferenceError: btoa is not defined\n    at sandbox.js:8:31\n    at sandbox.js:66:42\n    at Script.runInContext (node:vm:141:12)\n    at run (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:177:25)\n    at run (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:184:30)\n    at WorkerReporter._runInSandbox (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:180:20)\n    at WorkerReporter.runInSandbox (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\reporter.js:152:17)\n    at async executeScript (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\executeScript.js:122:12)\n    at async Scripts._runScript (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:140:30)\n    at async Scripts.handleBeforeRender (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:64:7)","meta":{"rootId":"gkjiekoqs3pi1b4","id":"gkjiekoqs3pi1b4"},"id":"twk2lqt1cb6tmzf","previousOperationId":"tqq8rusyh84l1im"}
{"type":"log","timestamp":1674833611252,"level":"warn","message":"Rendering request 20 finished with error in 80 ms","meta":{"rootId":"gkjiekoqs3pi1b4","id":"gkjiekoqs3pi1b4"},"id":"efkmwjrblo07udc","previousOperationId":"tqq8rusyh84l1im"}
{"type":"error","timestamp":1674833611257,"statusCode":400,"weak":true,"lineNumber":8,"decoratedSuffix":"\n\n(sandbox.js line 8:31)\n\n   6 | const options = {\n   7 |   headers: {\n>  8 |     'Authorization': 'Basic ' + btoa(username + ':' + password)\n     |                               ^\n   9 |   }\n  10 | };\n  11 |\n\n(sandbox.js line 66:42)\n\n  64 | // }\n\n","entity":{"shortid":"9YPNq7VwU2","name":"SpaceInVRs-mainscript","content":"// Use the \"beforeRender\" or \"afterRender\" hook\n// to manipulate and control the report generation\nconst axios = require('axios');\nconst nodemailer = require('nodemailer')\n\nconst options = {\n  headers: {\n    'Authorization': 'Basic ' + btoa(username + ':' + password)\n  }\n};\n\nasync function beforeRender(req, res) {\n\n\n    const resSessions = await axios.get('http://localhost:4000/api/sessions', options)\n    console.log(resSessions)\n    req.data.sessions = { ...req.data,\n        ...resSessions.data\n    }\n\n    req.data.score = req.data.sessions.score;\n    req.data.ships_destroyed = req.data.sessions.ships_destroyed;\n    req.data.bullets_fired = req.data.sessions.bullets_fired;\n    req.data.powerups = req.data.sessions.powerups;\n\n    console.log(\"Aquí el score: \" + req.data.score);\n    console.log(\"Aquí las naves destruidas: \" + req.data.ships_destroyed);\n\n    const resUsers = await axios.get('http://localhost:4000/api/users', options)\n    console.log(resUsers)\n    req.data.users = { ...req.data,\n        ...resUsers.data\n    }\n\n    req.data.user = req.data.users;\n\n}\n\n// async function afterRender(req, res) {\n\n//     const transporter = nodemailer.createTransport({\n//         host: 'smtp.ethereal.email',\n//         port: 587,\n//         auth: {\n//             user: 'isom26@ethereal.email',\n//             pass: 'sQEWpaYJug5tattpkZ'\n//         }\n//     });\n\n\n\n\n//     await transporter.sendMail({\n//         from: 'kvalls.contact@gmail.com',\n//         to: \"isom26@ethereal.email\",\n//         subject: 'CRUD report',\n//         text: '...',\n//         attachments: [{\n//             filename: 'Data.pdf',\n//             content: Buffer.from(res.content)\n//         }],\n//     })\n\n// }"},"property":"content","logged":true,"previousOperationId":"tqq8rusyh84l1im","id":"g7c7siblz68meuv","stack":"ReferenceError: btoa is not defined\n    at sandbox.js:8:31\n    at sandbox.js:66:42\n    at Script.runInContext (node:vm:141:12)\n    at run (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:177:25)\n    at run (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:184:30)\n    at WorkerReporter._runInSandbox (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:180:20)\n    at WorkerReporter.runInSandbox (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\reporter.js:152:17)\n    at async executeScript (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\executeScript.js:122:12)\n    at async Scripts._runScript (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:140:30)\n    at async Scripts.handleBeforeRender (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:64:7)","message":"Error when evaluating custom script /SpaceInVRs/SpaceInVRs-mainscript\nbtoa is not defined\n\n(sandbox.js line 8:31)\n\n   6 | const options = {\n   7 |   headers: {\n>  8 |     'Authorization': 'Basic ' + btoa(username + ':' + password)\n     |                               ^\n   9 |   }\n  10 | };\n  11 |\n\n(sandbox.js line 66:42)\n\n  64 | // }\n\n"}
