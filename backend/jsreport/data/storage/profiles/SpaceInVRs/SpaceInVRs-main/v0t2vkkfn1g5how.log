{"type":"operationStart","subtype":"profile","data":{"_id":"01oKneLYwboiQrcM","timestamp":"2023-02-22T18:18:44.048Z","state":"queued","mode":"standard","creationDate":"2023-02-22T18:18:44.050Z","modificationDate":"2023-02-22T18:18:44.050Z","shortid":"5tL32sW","$entitySet":"profiles"},"doDiffs":false,"timestamp":1677089924049,"id":"gvam69s5pkv3wth","previousOperationId":null,"operationId":"fqiiskztj7sy8xd"}
{"type":"log","level":"info","message":"Render request 60 queued for execution and waiting for available worker","previousOperationId":"fqiiskztj7sy8xd","timestamp":1677089924049,"id":"cp697vkvlk9i1sl"}
{"type":"operationStart","subtype":"render","name":"SpaceInVRs-main","previousOperationId":"fqiiskztj7sy8xd","timestamp":1677089924058,"id":"df2g41tndgtyjf5","previousEventId":"gvam69s5pkv3wth","operationId":"yb88hcbo8gp2muq"}
{"type":"log","timestamp":1677089924059,"level":"info","message":"Starting rendering request 60","meta":{"rootId":"v0t2vkkfn1g5how","id":"v0t2vkkfn1g5how"},"id":"2gcqpo0kwrbumjp","previousOperationId":"yb88hcbo8gp2muq"}
{"type":"log","timestamp":1677089924059,"level":"info","message":"Rendering template { name: SpaceInVRs-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"v0t2vkkfn1g5how","id":"v0t2vkkfn1g5how"},"id":"w4xpgd5ci8ivll8","previousOperationId":"yb88hcbo8gp2muq"}
{"type":"log","timestamp":1677089924061,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"v0t2vkkfn1g5how","id":"v0t2vkkfn1g5how"},"id":"7cn0qp0exich5so","previousOperationId":"yb88hcbo8gp2muq"}
{"type":"log","timestamp":1677089924063,"level":"debug","message":"Executing script SpaceInVRs-mainscript (beforeRender)","meta":{"rootId":"v0t2vkkfn1g5how","id":"v0t2vkkfn1g5how"},"id":"2xiqo1uu7zafl2h","previousOperationId":"yb88hcbo8gp2muq"}
{"type":"log","timestamp":1677089924073,"level":"warn","message":"Error when processing render request 60\n(because) error when evaluating custom script /SpaceInVRs/SpaceInVRs-mainscript\nUnexpected token '=>'\nsandbox.js:21\n        ...resSessions.data.map(=> {\n                                ^^\n\nSyntaxError: Unexpected token '=>'\n    at new Script (node:vm:100:7)\n    at doCompileScript (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:224:14)\n    at run (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:169:72)\n    at WorkerReporter._runInSandbox (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:180:20)\n    at WorkerReporter.runInSandbox (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\reporter.js:152:17)\n    at async executeScript (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\executeScript.js:122:12)\n    at async Scripts._runScript (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:140:30)\n    at async Scripts.handleBeforeRender (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:64:7)\n    at async ListenerCollection.fire (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\shared\\listenerCollection.js:157:21)\n    at async beforeRender (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\render\\render.js:25:5)","meta":{"rootId":"v0t2vkkfn1g5how","id":"v0t2vkkfn1g5how"},"id":"mymeboizgwrrc7z","previousOperationId":"yb88hcbo8gp2muq"}
{"type":"log","timestamp":1677089924073,"level":"warn","message":"Rendering request 60 finished with error in 25 ms","meta":{"rootId":"v0t2vkkfn1g5how","id":"v0t2vkkfn1g5how"},"id":"w5rlmo5wqm6x9ru","previousOperationId":"yb88hcbo8gp2muq"}
{"type":"error","timestamp":1677089924078,"statusCode":400,"weak":true,"entity":{"shortid":"9YPNq7VwU2","name":"SpaceInVRs-mainscript","content":"// Use the \"beforeRender\" or \"afterRender\" hook\r\n// to manipulate and control the report generation\r\nconst axios = require('axios');\r\nconst nodemailer = require('nodemailer')\r\n\r\nconst options = {\r\n  auth: {\r\n    username: 'myUsername',\r\n    password: 'myPassword'\r\n  }\r\n};\r\n\r\nasync function beforeRender(req, res) {\r\n\r\nconsole.log('AAAAAAAAAAAAAAAAAAAAAAA ' , req);\r\n\r\n    const resSessions = await axios.get('http://localhost:4000/api/sessions', options)\r\n    // console.log(resSessions)\r\n\r\n    req.data.sessions = { ...req.data,\r\n        ...resSessions.data.map(=> {\r\n          return {\r\n            ...session,\r\n            finalscore: session.score - session.bullets_fired\r\n          }\r\n        })\r\n    }\r\n\r\n    console.log(req.data.sessions[0].score)\r\n\r\n    req.data.score = req.data.sessions.score;\r\n    req.data.ships_destroyed = req.data.sessions.ships_destroyed;\r\n    req.data.bullets_fired = req.data.sessions.bullets_fired;\r\n    req.data.powerups = req.data.sessions.powerups;\r\n    req.data.user_id = req.data.sessions.user_id;\r\n    \r\n\r\n    console.log(\"Aquí el score: \" + req.data.sessions.score);\r\n    console.log(\"Aquí las naves destruidas: \" + req.data.ships_destroyed);\r\n\r\n    const resUsers = await axios.get('http://localhost:4000/api/users', options)\r\n    // console.log(resUsers)\r\n    req.data.users = { ...req.data,\r\n        ...resUsers.data\r\n    }\r\n\r\n    req.data.user = req.data.users;\r\n    req.data.username = req.data.users.name;\r\n\r\n}\r\n\r\n// async function afterRender(req, res) {\r\n\r\n//     const transporter = nodemailer.createTransport({\r\n//         host: 'smtp.ethereal.email',\r\n//         port: 587,\r\n//         auth: {\r\n//             user: 'isom26@ethereal.email',\r\n//             pass: 'sQEWpaYJug5tattpkZ'\r\n//         }\r\n//     });\r\n\r\n\r\n\r\n\r\n//     await transporter.sendMail({\r\n//         from: 'kvalls.contact@gmail.com',\r\n//         to: \"isom26@ethereal.email\",\r\n//         subject: 'CRUD report',\r\n//         text: '...',\r\n//         attachments: [{\r\n//             filename: 'Data.pdf',\r\n//             content: Buffer.from(res.content)\r\n//         }],\r\n//     })\r\n\r\n// }"},"property":"content","logged":true,"previousOperationId":"yb88hcbo8gp2muq","id":"65raqq5y7mi8zl6","stack":"sandbox.js:21\n        ...resSessions.data.map(=> {\n                                ^^\n\nSyntaxError: Unexpected token '=>'\n    at new Script (node:vm:100:7)\n    at doCompileScript (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:224:14)\n    at run (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:169:72)\n    at WorkerReporter._runInSandbox (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:180:20)\n    at WorkerReporter.runInSandbox (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\reporter.js:152:17)\n    at async executeScript (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\executeScript.js:122:12)\n    at async Scripts._runScript (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:140:30)\n    at async Scripts.handleBeforeRender (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:64:7)\n    at async ListenerCollection.fire (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\shared\\listenerCollection.js:157:21)\n    at async beforeRender (C:\\Users\\Kris\\Desktop\\2DAM\\Project\\SpaceInVRs\\backend\\jsreport\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\render\\render.js:25:5)","message":"Error when evaluating custom script /SpaceInVRs/SpaceInVRs-mainscript\nUnexpected token '=>'"}
